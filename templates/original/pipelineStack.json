{
  "Parameters": {
    "AWSCodePipelineService": {
      "Default": "arn:aws:iam::835483671006:role/AWS-CodePipeline-Service",
      "Type": "String"
    },
    "ArtifactStoreS3Location": {
      "Default": "awscodepipelinetestbucketcf",
      "Type": "String"
    },
    "BranchName": {
      "Default": "master",
      "Type": "String"
    },
    "ChangeSetName": {
      "Default": "MyChangeSet",
      "Type": "String"
    },
    "ProjectName": {
      "Default": "SvenTestBuild",
      "Type": "String"
    },
    "RepositoryName": {
      "Default": "pipelineTestRepo",
      "Type": "String"
    },
    "StackName": {
      "Default": "MyBetaStack",
      "Type": "String"
    },
    "TemplatePath": {
      "Default": "MyAppBuild::outputSamTemplate.yaml",
      "Type": "String"
    }
  },
  "Resources": {
    "AppPipeline": {
      "Properties": {
        "ArtifactStore": {
          "Location": {
            "Ref": "ArtifactStoreS3Location"
          },
          "Type": "S3"
        },
        "RoleArn": {
          "Ref": "AWSCodePipelineService"
        },
        "Stages": [
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Source",
                  "Owner": "AWS",
                  "Provider": "CodeCommit",
                  "Version": "1"
                },
                "Configuration": {
                  "BranchName": {
                    "Ref": "BranchName"
                  },
                  "RepositoryName": {
                    "Ref": "RepositoryName"
                  }
                },
                "Name": "SourceAction",
                "OutputArtifacts": [
                  {
                    "Name": "SourceOutput"
                  }
                ],
                "RunOrder": 1
              }
            ],
            "Name": "Source"
          },
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1"
                },
                "Configuration": {
                  "ProjectName": {
                    "Ref": "ProjectName"
                  }
                },
                "InputArtifacts": [
                  {
                    "Name": "SourceOutput"
                  }
                ],
                "Name": "CodeBuild",
                "OutputArtifacts": [
                  {
                    "Name": "MyAppBuild"
                  }
                ],
                "RunOrder": 1
              }
            ],
            "Name": "Build"
          },
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1"
                },
                "Configuration": {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "ChangeSetName": {
                    "Ref": "ChangeSetName"
                  },
                  "StackName": {
                    "Ref": "StackName"
                  },
                  "TemplatePath": {
                    "Ref": "TemplatePath"
                  }
                },
                "InputArtifacts": [
                  {
                    "Name": "MyAppBuild"
                  }
                ],
                "Name": "Staging",
                "RunOrder": 1
              }
            ],
            "Name": "Staging"
          },
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1"
                },
                "Configuration": {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": {
                    "Ref": "ChangeSetName"
                  },
                  "StackName": {
                    "Ref": "StackName"
                  }
                },
                "InputArtifacts": [
                  {
                    "Name": "MyAppBuild"
                  }
                ],
                "Name": "Deploy",
                "RunOrder": 1
              }
            ],
            "Name": "Deploy"
          }
        ]
      },
      "Type": "AWS::CodePipeline::Pipeline"
    }
  }
}
